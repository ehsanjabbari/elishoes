<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>elishoes - ูุฏุฑุช ููุฌูุฏ ูุฑูุดฺฏุงู</title>
    
    <!-- PWA and iOS specific meta tags -->
    <meta name="description" content="ุณุณุชู ูุฏุฑุช ููุฌูุฏ ูุฑูุดฺฏุงู ุจุง ูุงุจูุช ููุงููฺฏโุณุงุฒ GitHub">
    <meta name="application-name" content="elishoes">
    <meta name="apple-mobile-web-app-title" content="elishoes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#dc2626">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="theme-color" content="#dc2626">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="shortcut icon" href="icons/favicon-32x32.png">
    
    <!-- Apple Touch Icons for iOS -->
    <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/apple-touch-icon-192x192.png">
    
    <!-- Android Chrome -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/android-chrome-512x512.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Standard links -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-btn" id="mobile-menu-btn">
        <i data-lucide="menu"></i>
    </button>
    
    <!-- Mobile overlay -->
    <div class="mobile-overlay" id="mobile-overlay"></div>
    
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>ูุฏุฑุช ููุฌูุฏ</h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-tab="products">
                    <i data-lucide="package"></i>
                    <span>ูุญุตููุงุช</span>
                </li>
                <li class="nav-item" data-tab="input-invoices">
                    <i data-lucide="file-plus"></i>
                    <span>ูุงฺฉุชูุฑูุง ูุฑูุฏ</span>
                </li>
                <li class="nav-item" data-tab="sales-151">
                    <i data-lucide="shopping-cart"></i>
                    <span>ูุฑูุด151</span>
                </li>
                <li class="nav-item" data-tab="sales-168">
                    <i data-lucide="trending-up"></i>
                    <span>ูุฑูุด168</span>
                </li>
                <li class="nav-item" data-tab="inventory">
                    <i data-lucide="archive"></i>
                    <span>ููุฌูุฏ</span>
                </li>
                <li class="nav-item" data-tab="settings">
                    <i data-lucide="settings"></i>
                    <span>ูุฏุฑุช ุงุทูุงุนุงุช</span>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Products Tab -->
            <div id="products" class="tab-content active">
                <div class="content-header">
                    <h2>ูุฏุฑุช ูุญุตููุงุช</h2>
                    <button class="primary-btn" id="add-product">
                        <i data-lucide="plus"></i>
                        ุงูุฒูุฏู ูุญุตูู
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="products-table">
                        <thead>
                            <tr>
                                <th>ูุงู ูุญุตูู</th>
                                <th>ุนููุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Products will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Input Invoices Tab -->
            <div id="input-invoices" class="tab-content">
                <div class="content-header">
                    <h2>ูุงฺฉุชูุฑูุง ูุฑูุฏ</h2>
                    <button class="primary-btn" id="add-input-invoice">
                        <i data-lucide="plus"></i>
                        ุงูุฒูุฏู ูุงฺฉุชูุฑ ูุฑูุฏ
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="input-invoices-table">
                        <thead>
                            <tr>
                                <th>ุชุงุฑุฎ</th>
                                <th>ูุญุตููุงุช</th>
                                <th>ุนููุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Input invoices will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sales 151 Tab -->
            <div id="sales-151" class="tab-content">
                <div class="content-header">
                    <h2>ูุฑูุด151</h2>
                    <button class="primary-btn" id="add-sale-151">
                        <i data-lucide="plus"></i>
                        ุงูุฒูุฏู ูุงฺฉุชูุฑ ูุฑูุด
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="sales-151-table">
                        <thead>
                            <tr>
                                <th>ุชุงุฑุฎ</th>
                                <th>ูุญุตููุงุช</th>
                                <th>ุนููุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Sales 151 will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sales 168 Tab -->
            <div id="sales-168" class="tab-content">
                <div class="content-header">
                    <h2>ูุฑูุด168</h2>
                    <button class="primary-btn" id="add-sale-168">
                        <i data-lucide="plus"></i>
                        ุงูุฒูุฏู ูุงฺฉุชูุฑ ูุฑูุด
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="sales-168-table">
                        <thead>
                            <tr>
                                <th>ุชุงุฑุฎ</th>
                                <th>ูุญุตููุงุช</th>
                                <th>ุนููุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Sales 168 will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory" class="tab-content">
                <div class="content-header">
                    <h2>ููุฌูุฏ ฺฉุงูุง</h2>
                </div>
                <div class="table-container">
                    <table class="data-table" id="inventory-table">
                        <thead>
                            <tr>
                                <th>ูุงู ฺฉุงูุง</th>
                                <th>ุชุนุฏุงุฏ ูุฑูุฏ</th>
                                <th>ุชุนุฏุงุฏ ูุฑูุด</th>
                                <th>ููุฌูุฏ ููุง</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Inventory will be dynamically calculated and displayed here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="content-header">
                    <h2>ูุฏุฑุช ุงุทูุงุนุงุช</h2>
                </div>
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>ุจฺฉุงูพ ู ุฑุณุชูุฑ</h3>
                        <div class="settings-actions">
                            <button class="secondary-btn" id="backup-data">
                                <i data-lucide="download"></i>
                                ุจฺฉุงูพ ฺฏุฑูุชู
                            </button>
                            <input type="file" id="restore-file" accept=".json" style="display: none;">
                            <button class="secondary-btn" id="restore-data">
                                <i data-lucide="upload"></i>
                                ุฑุณุชูุฑ ุจฺฉุงูพ
                            </button>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3>๐ค ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ GitHub</h3>
                        <div class="settings-group">
                            <label>ุชูฺฉู Personal Access:</label>
                            <input type="password" id="github-token" placeholder="ghp_..." class="settings-input">
                            <small class="settings-help">
                                ุงุฒ GitHub > Settings > Developer settings > Personal access tokens
                            </small>
                        </div>
                        <div class="settings-group">
                            <label>ุดูุงุณู Gist:</label>
                            <input type="text" id="github-gist-id" placeholder="ูุดุงู Gist ุง ููุท ID" class="settings-input">
                            <small class="settings-help">
                                ุงฺฏุฑ Gist ูุฌูุฏ ุฏุงุฑุฏุ ID ุขู ุฑุง ูุงุฑุฏ ฺฉูุฏ
                            </small>
                        </div>
                        <div class="settings-actions">
                            <button class="primary-btn" onclick="saveGitHubSettings()">
                                <i data-lucide="save"></i>
                                ุฐุฎุฑู ุชูุธูุงุช
                            </button>
                            <button class="secondary-btn" onclick="createNewGitHubGist()">
                                <i data-lucide="plus"></i>
                                ุงุฌุงุฏ Gist ุฌุฏุฏ
                            </button>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3>๐ ููฺฏุงูโุณุงุฒ</h3>
                        <div class="settings-actions">
                            <button class="primary-btn" onclick="backupToGitHubGist()">
                                <i data-lucide="upload"></i>
                                ุงุฑุณุงู ุจฺฉุงูพ ุจู GitHub
                            </button>
                            <button class="secondary-btn" onclick="loadFromGitHubGist()">
                                <i data-lucide="download"></i>
                                ุจุงุฑฺฏุฑ ุงุฒ GitHub
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for Add/Edit Product -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="product-modal-title">ุงูุฒูุฏู ูุญุตูู</h3>
                <button class="close-btn" data-lucide="x"></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="product-name">ูุงู ูุญุตูู:</label>
                    <input type="text" id="product-name" placeholder="ูุงู ูุญุตูู ุฑุง ูุงุฑุฏ ฺฉูุฏ">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" data-action="cancel">ูุบู</button>
                <button class="primary-btn" data-action="save">ุซุจุช</button>
            </div>
        </div>
    </div>

    <!-- Modal for Add/Edit Invoice -->
    <div id="invoice-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="invoice-modal-title">ุงูุฒูุฏู ูุงฺฉุชูุฑ</h3>
                <button class="close-btn" data-lucide="x"></button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="invoice-date">ุชุงุฑุฎ:</label>
                    <input type="text" id="invoice-date" placeholder="ูุซุงู: 1404/08/16">
                </div>
                <div class="form-group">
                    <label>ูุญุตููุงุช:</label>
                    <div id="invoice-products">
                        <div class="product-row">
                            <select class="product-select">
                                <option value="">ุงูุชุฎุงุจ ูุญุตูู</option>
                            </select>
                            <input type="number" class="product-quantity" placeholder="ุชุนุฏุงุฏ" min="1">
                            <button class="remove-product-btn" data-lucide="trash-2"></button>
                        </div>
                    </div>
                    <button class="secondary-btn" id="add-product-row">
                        <i data-lucide="plus"></i>
                        ุงูุฒูุฏู ูุญุตูู
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" data-action="cancel">ูุบู</button>
                <button class="primary-btn" data-action="save">ุซุจุช</button>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ุชุฃุฏ ุญุฐู</h3>
            </div>
            <div class="modal-body">
                <p>ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ููุฑุฏ ุฑุง ุญุฐู ฺฉูุฏุ</p>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" data-action="cancel">ูุบู</button>
                <button class="danger-btn" data-action="confirm">ุญุฐู</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        lucide.createIcons();
        
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New update available
                                    if (confirm('ูุณุฎู ุฌุฏุฏ ุจุฑูุงูู ููุฌูุฏ ุงุณุช. ุขุง ูโุฎูุงูุฏ ุจูโุฑูุฒุฑุณุงู ุดูุฏุ')) {
                                        newWorker.postMessage({ action: 'skipWaiting' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // iOS PWA installation prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button (optional)
            const installBtn = document.createElement('button');
            installBtn.textContent = 'ูุตุจ ุฏุฑ ุตูุญู ุงุตู';
            installBtn.style.cssText = 'position: fixed; bottom: 20px; right: 20px; background: #dc2626; color: white; border: none; padding: 12px 20px; border-radius: 25px; cursor: pointer; z-index: 1000; font-family: Vazirmatn; font-size: 14px; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);';
            installBtn.onclick = () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted PWA install');
                        }
                        deferredPrompt = null;
                        installBtn.remove();
                    });
                }
            };
            document.body.appendChild(installBtn);
            
            // Remove button after 30 seconds
            setTimeout(() => {
                if (installBtn.parentNode) {
                    installBtn.remove();
                }
            }, 30000);
        });
        
        // iOS PWA launch
        window.addEventListener('DOMContentLoaded', () => {
            // iOS standalone detection
            const isInStandaloneMode = (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches);
            console.log('iOS PWA mode:', isInStandaloneMode);
        });
    </script>
</body>
</html>